<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong/public/resource :: copy"></head>
<body>
<link th:href="${basePath}+'/assets/style/whzt/whzt.css'" rel="stylesheet">
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong/public/header :: copy"></div>
        <!--公共主头部结束-->
        <div class="recomment-brand">
            <div class="recomment-brand-banner">
                <ul>
                    <!--<li>
                        <div class="info">
                            <div class="title"></div>
                            <div class="text">
                            </div>
                            <a class="btn" style="display: none">了解详情</a>
                        </div>
                        <div class="img">
                            <img alt="" width="480" height="320">
                        </div>
                    </li>-->
                </ul>
            </div>
            <div class="pages">
                <ul class="cleafrix">
                    <!--<li>
                        <div class="img">
                            <img th:src="${basePath}+'/assets/img/img_demo/q1.jpg'" alt="" width="192" height="128">
                        </div>
                        <div class="text">广东省少儿艺术花会</div>
                    </li>
                    <li>
                        <div class="img">
                            <img th:src="${basePath}+'/assets/img/img_demo/q2.jpg'" alt="" width="192" height="128">
                        </div>
                        <div class="text">广东省少儿艺术花会</div>
                    </li>
                    <li>
                        <div class="img">
                            <img th:src="${basePath}+'/assets/img/img_demo/q3.jpg'" alt="" width="192" height="128">
                        </div>
                        <div class="text">广东省少儿艺术花会</div>
                    </li>
                    <li>
                        <div class="img">
                            <img th:src="${basePath}+'/assets/img/img_demo/q4.jpg'" alt="" width="192" height="128">
                        </div>
                        <div class="text">广东省少儿艺术花会</div>
                    </li>
                    <li>
                        <div class="img">
                            <img th:src="${basePath}+'/assets/img/img_demo/q5.jpg'" alt="" width="192" height="128">
                        </div>
                        <div class="text">广东省少儿艺术花会</div>
                    </li>-->
                </ul>
                <div class="green-black" id="pagging" style="margin-bottom: 40px;margin-top:30px;"></div>
            </div>
            <div class="arrows">
                <div class="prev left-prev"></div>
                <div class="prev right-prev"></div>
            </div>
        </div>
        <div class="recomment-mask">
            <img th:src="${basePath}+'/assets/img/img_demo/q5.jpg'">
        </div>
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong/public/footer :: copy"></div>
<!--底部结束-->
<script th:src="${basePath}+'/assets/js/public/sly.js'" type="text/javascript"></script>
<script type="text/javascript" th:inline="javascript">


    function removeHTMLTag(str) {
        str = str.replace(/<\/?[^>]*>/g,''); //去除HTML tag
        str = str.replace(/[ | ]*\n/g,'\n'); //去除行尾空白
        //str = str.replace(/\n[\s| | ]*\r/g,'\n'); //去除多余空行
        str=str.replace(/&nbsp;/ig,'');//去掉&nbsp;
        return str;
    }


    $(function(){
       pageTools.init();
    });

    var pageTools = {
        bashPath: [[${basePath}]],
        url_list: [[${apiPath.brandlist}]],
        batchListUrl: [[${apiPath.batchlist}]],

        init: function(){
            this.loadRows();

            var me = this;
            $(".arrows .prev").on("click", function(){
                var isleft = $(this).hasClass("left-prev");
                var currPage = 1;
                if (me.params && me.params.page) {
                    currPage = me.params.page;
                }
                if (isleft){
                    currPage -= 1;
                } else {
                    currPage += 1;
                }

                if (currPage <= 0){
                    currPage = 1;
                }
                me.loadRows(currPage);
            });
        },

        loadRows: function(page, pageSize){
            var me = this;
            me.params = me.params || {};
            me.params.page = page || me.params.page || 1;
            me.params.pageSize = pageSize || 1;
            me.params.cultid = $.cookie('cultid') || '';

            $.post(me.url_list, me.params, function(data){
                me.appendRows(data);
                if (data.total <= data.pageSize){
                    $(".arrows .prev").hide();
                }else{
                    $(".arrows .prev").show();
                }
            }, "JSON");
        },

        appendRows: function(data){
            var me = this;

            if (!data || !data.rows){
                return;
            }

            me.params = me.params||{};
            me.params.page = data.page || me.params.page || 1;

            var rowTemp = '<li>\
                    <div class="info">\
                        <div class="title"></div>\
                        <div class="text"></div>\
                        <a class="btn" style="display: none">了解详情</a>\
                    </div>\
                    <div class="img">\
                        <img alt="" width="480" height="320">\
                    </div>\
                    </li>';

            var rowsParent = $(".recomment-brand-banner ul");
            rowsParent.empty();
            var imgPath = data.imgPath;

            var rows = data.rows;
            for(var i in rows) {
                var row = rows[i];
                var rowli = $(rowTemp);
                rowsParent.append(rowli);

                if (i==0){
                    me.brandid = row.id;
                    me.loadBatchs();
                }

                var imgsrc = imgPath + row.imgurl;
                rowli.find(".info .title").text(row.title);
                rowli.find(".info .text").html( removeHTMLTag(row.description) );
                rowli.find('img').attr({"src": imgsrc, "alt":row.title});
                rowli.find(".info a").show().attr("href", me.bashPath+"/whzt/index?id=&brandid="+row.id);
            }
        },

        loadBatchs: function(page, pageSize){
            var me = this;

            var params = {};
            params.page = page || 1;
            params.pageSize = pageSize || 5;
            params.cultid = $.cookie('cultid') || '';
            params.brandid  = me.brandid;

            $.post(me.batchListUrl, params, function(data){
                me.appendBatchList(data);
                dataInit.pageInit("pagging", params.page, params.pageSize, data.total, function(page, pageSize){me.loadBatchs(page,pageSize)});
            }, "JSON");
        },

        appendBatchList: function(data){
            var me = this;
            var rowsParent = $(".pages ul");
            rowsParent.empty();
            if (!data || !data.rows || !data.rows.length){
                return;
            }

            var rowTemp = '<li>\
                 <div class="img">\
                    <img alt="" width="192" height="128">\
                 </div>\
                 <div class="text">广东省少儿艺术花会</div>\
            </li>';

            var imgPath = data.imgPath;
            for (var i in data.rows){
                var row = data.rows[i];
                var rowli = $(rowTemp);
                rowsParent.append(rowli);

                rowli.find("img").attr("src", imgPath + dataInit.getImage(row.imgurl, 300,200));
                rowli.find(".text").text(row.title);
                rowli.on("click", {row: row, imgPath: imgPath}, function(e){
                     var row = e.data.row;
                     window.location.href = me.bashPath+"/whzt/index?id="+row.id+"&brandid="+row.brandid;
                });
            }
        }

    }

</script>
</body>
</html>