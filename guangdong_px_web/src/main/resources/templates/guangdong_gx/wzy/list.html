<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong_gx/public/resource :: copy"></head>
<body>
<link rel="stylesheet" th:href="${basePath}+'/assets/style/public/majorlist.css'">
<link rel="stylesheet" th:href="${basePath}+'/assets/style/public/list.css'">
<style>
    .jieshao{
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
    }
</style>
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong_gx/public/header :: copy"></div>
        <!--公共主头部结束-->
        <!--首页轮播开始-->
        <div class="banner">
            <div class="big-banner">
                <div class="banner-count">
                    <ul id="showLbt">
                        <!--<li style="background-image: url(http://119.23.73.71:8080/whgstatic/img/2017/201707/20170715/c4340234b55b47dd8fcf41c40409dd75.jpg)">
                                                    <a href=""></a>
                        </li>-->
                    </ul>
                </div>
            </div>
        </div>
        <!--首页轮播结束-->
        <!--主体开始-->
        <div class="categoryChange">
            <div class="row clearfix">
                <div class="title">区域：</div>
                <div class="adrList" id="areList"></div>
            </div>
        </div>
        <div class="major-nav">
            <ul class="clearfix">
                <li class="active">
                    <div class="logo music"></div>
                    <div class="title" data-type="0">音乐</div>
                </li>
                <li class="">
                    <div class="logo wudao"></div>
                    <div class="title" data-type="1">舞蹈</div>
                </li>
                <li class="">
                    <div class="logo meishu"></div>
                    <div class="title" data-type="2">美术</div>
                </li>
                <li class="">
                    <div class="logo xiju"></div>
                    <div class="title" data-type="3">戏剧</div>
                </li>
                <li class="">
                    <div class="logo quyi"></div>
                    <div class="title" data-type="4">曲艺</div>
                </li>
                <li class="">
                    <div class="logo shufa"></div>
                    <div class="title" data-type="5">书法</div>
                </li>
                <li class="">
                    <div class="logo sheying"></div>
                    <div class="title" data-type="6">摄影</div>
                </li>
            </ul>
        </div>
        <div class="major-content">
            <ul id="modelList">
                <!--<li class="clearfix">
                    <div class="detail">
                        <h2 class="title">哦，这是一个标题</h2>
                        <p class="text">适宜人群：<span>7-12岁人群，有一定基础</span></p>
                        <p class="text jieshao">专业介绍：<span>这是一段很长的专业介绍这是一段很长的专
                                这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍
                                这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍
                                业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍</span>
                        </p>
                        <a class="view-details" href="detail">查看详情</a>
                    </div>
                    <div class="train">
                        <div class="train-label">
                            <div class="img">
                                <a href="javascript:void(0)">
                                    <img src="http://tz.fm918.top:8092/whgstatic/img/2017/201709/20170921/a768d33e5359460e910de9c08ce4425d_750_500.jpg">
                                </a>
                            </div>
                            <p><a href="javascript:void(0)">培训标题培训标题培训标题培训标题培训标题</a></p>
                        </div>
                        <div class="train-label">
                            <div class="img">
                                <a href="javascript:void(0)">
                                    <img src="http://tz.fm918.top:8092/whgstatic/img/2017/201709/20170921/e7f2cf27ba3b41b680c1f10651db8800_750_500.jpg">
                                </a>
                            </div>
                            <p><a href="javascript:void(0)">培训标题培训标题培训标题培训标题培训标题</a></p>
                        </div>
                    </div>
                </li>
                <li class="clearfix">
                    <div class="detail">
                        <h2 class="title">哦，这是一个标题</h2>
                        <p class="text">适宜人群：<span>7-12岁人群，有一定基础</span></p>
                        <p class="text jieshao">专业介绍：<span>这是一段很长的专业介绍这是一段很长的专
                                这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍
                                这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍
                                业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍这是一段很长的专业介绍</span>
                        </p>
                        <a class="view-details" href="detail">查看详情</a>
                    </div>
                    <div class="train">
                        <div class="train-label">
                            <div class="img">
                                <a href="javascript:void(0)">
                                    <img src="http://tz.fm918.top:8092/whgstatic/img/2017/201709/20170921/a768d33e5359460e910de9c08ce4425d_750_500.jpg">
                                </a>
                            </div>
                            <p><a href="javascript:void(0)">培训标题培训标题培训标题培训标题培训标题</a></p>
                        </div>
                        <div class="train-label">
                            <div class="img">
                                <a href="javascript:void(0)">
                                    <img src="http://tz.fm918.top:8092/whgstatic/img/2017/201709/20170921/e7f2cf27ba3b41b680c1f10651db8800_750_500.jpg">
                                </a>
                            </div>
                            <p><a href="javascript:void(0)">培训标题培训标题培训标题培训标题培训标题</a></p>
                        </div>
                    </div>
                </li>-->
            </ul>

            <!--分页开始 -->
            <div class="green-black" id="artPagging" style="margin-bottom: 40px;margin-top:60px;"></div>
            <!--分页结束-->
        </div>
        <!--主体结束-->
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong_gx/public/footer :: copy"></div>
<!--底部结束-->
<a class="to-top"></a>

<script type="text/javascript" th:inline="javascript">
    var etype = [[${etype}]] || "0";//分类
    $(".major-nav ul li").on("click",function () {
        $(this).addClass("active").siblings().removeClass("active");
        pageType = $(this).children(".title").attr('data-type');
        if (pageType == 0) {
            etype = '0';
        } else if (pageType == 1) {
            etype = '1';
        } else if (pageType == 2) {
            etype = '2';
        }else if (pageType == 3) {
            etype = '3';
        }else if (pageType == 4) {
            etype = '4';
        }else if (pageType == 5) {
            etype = '5';
        }else if (pageType == 6) {
            etype = '6';
        }
        dataPage();
        //window.location.href = [[${basePath}]]+'/'+[[${cultsite}]]+'/wzy/list?etype='+etype;
    });

    $(function () {
        showAre($.cookie("city"));
        $(".major-nav ul li").each(function () {
            pageType = $(this).children(".title").attr('data-type');
            if(pageType == etype){
                $(this).addClass("active").siblings().removeClass("active");
            }
        });
        dataPage();
    })

    //加载数据
    function dataPage(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 12;
        var params = {
            page:params_page,
            pageSize:rows,
            etype:etype,
            cultid:$.cookie('cultid'),
            deptid: $("#deptid").val(), //部门id
            area: $("#area").val(), //区域
            city: $("#city").val(), //市
            province: $("#province").val() //省
        }
        //调用接口
        rongDialog.init({ico: 3, type: 1, desc: '', overTime: 8000});
        dataInit.ajax({
            api: [[${apiPath.indexTraMajorList}]],
            params: params,
            fn: function(data){
                rongDialog.closeMaskPanel();
                showModelList(data);
                dataInit.pageInit('artPagging', params_page, params_rows, data.total, dataPage);
            }
        })
    }

    //轮播图
    dataInit.ajax({
        api: [[${apiPath.showAdver}]],
        fn: banner, //首页轮播图数据
        params: {
            type: 3,
            city: $.cookie('city'),
            cultid: $.cookie('cultid')
        }
    });

    //生成HTML
    function showModelList(data) {
//        console.log(data);
        var modelList = $("#modelList");
        modelList.html("");
        if (data.code == 0) {
            if (data.rows.length > 0) {

                for (var i in data.rows) {
                    var model = data.rows[i];
                    var tramodel = data.rows[i].tralist;

                    var img = data.imgPath + dataInit.getSmallImage(model.image);
                    var tramodel_list = '';
                    if(tramodel){
                        for(var j in tramodel){
                            var _tramodel = tramodel[j]
                            var tramodel_imgPath = data.imgPath + _tramodel.trainimg;
                            var mdURL = _tramodel.islive == 1?
                                '../zxkc/detail?id='+_tramodel.id
                                : '../xxpx/detail?id='+_tramodel.id;
                            tramodel_list += '<div class="train-label">\
                                                <div class="img">\
                                                    <a href="'+mdURL+'"><img src="'+tramodel_imgPath+'"></a>\
                                                </div>\
                                                <p><a href="'+mdURL+'">'+_tramodel.title+'</a></p>\
                                            </div>';
                        }
                    }
                    var _jieshao = dataInit.removeHTMLTag(model.detail);
                    modelList.append('\
                        <li class="clearfix">\
                            <div class="detail">\
                                <h2 class="title">'+model.name+'</h2>\
                                <p class="text">适宜人群：<span>'+model.fitage+'</span></p>\
                                <p class="text jieshao">专业介绍：<span>'+_jieshao+'</span></p>\
                                <a class="view-details" href="detail?id='+model.id+'&etype='+etype+'">查看详情</a>\
                            </div>\
                            <div class="train">'+tramodel_list+'\
                            </div>\
                        </li>');



                }
            } else {
                modelList.append("<div class='public-no-message'></div>");
            }
        } else {
            rongDialog.init({ico: 2, type: 1, desc: data.msg});
        }
    }

    function banner(data) {
        if (data.rows.length && data.code == 0) {
            for (var i = 0; i < data.rows.length; i++) {
                if(data.rows[i].url&&data.rows[i].url!=""){
                    $("#showLbt").append('<li style="background-image:url(' + data.imgPath + data.rows[i].picture + ')"><a href="' + data.rows[i].url + '"></a></li>');
                }else{
                    $("#showLbt").append('<li style="background-image:url(' + data.imgPath + data.rows[i].picture + ')"><a href="javascript:void(0)"></a></li>');
                }
            }

        } else {
            var major_bannerPath = [[${basePath}]] + '/assets/img/major/major_banner.jpg';
            $("#showLbt").append('<li style="background-image:url(' + major_bannerPath + ')"><a href="javascript:void(0)"></a></li>');
        }
    }


    function setActive(dom){
        $(dom).parent('span').addClass("active").siblings().removeClass("active");
    }

    function setArea(dom, id) {
        var _province=$(dom).attr("_province");
        var _city=$(dom).attr("_city");
        var _area=$(dom).attr("_area");
        $("#province").val("");
        $("#city").val("");
        $("#area").val("");
        if(_province&&_province!=""){
            $("#province").val(_province);
        }
        if(_city&&_city!=""){
            $("#city").val(_city);
        }
        if(_area&&_area!=""){
            $("#area").val(_area);
        }
        dataPage();
        setActive(dom);
    }
</script>
</body>
</html>