<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.creatoo.hn.dao.mapper.api.ExtendDeliveryMapper">

    <select id="selDeliveryTimeCount" resultType="int">
        SELECT
            count(0)
        FROM
            whg_delivery d
        WHERE
            d.id IN (
                SELECT
                    dt.deliveryid
                FROM
                    whg_delivery_time dt
                WHERE
                    TO_DAYS(dt.deliverytime) = TO_DAYS(#{date}) AND dt.deliveryid in (SELECT d1.id from whg_delivery d1 where d1.fkid = #{supplyId})
            )
        AND d.state in (2,3)
    </select>


    <select id="selHaveDeliveryTimeCount" resultType="int">
        select  count(0) from whg_delivery d
        left join whg_delivery_time t on t.deliveryid = d.id
        where d.crtuser =  #{userId}
        and d.fkid =  #{supplyId}
        and d.state != 0 and TO_DAYS(t.deliverytime) = TO_DAYS(#{date})
    </select>

</mapper>