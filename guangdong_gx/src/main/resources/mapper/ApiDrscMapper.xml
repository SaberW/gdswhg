<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.creatoo.hn.dao.mapper.api.ApiDrscMapper">

    <select id="selectDrscList4page" resultType="hashmap">
        SELECT
        *
        FROM
        whg_drsc d
        WHERE
        d.drscstate = 6
        <if test="cultid!=null">
            AND d.drscvenueid  IN
            <foreach item="item" index="index" collection="cultid" open="(" separator="," close=")">
                #{item}
            </foreach>
            <if test="arttype!=null and arttype!=''.toString()"> AND d.drscarttyp = #{arttype} </if>
            <if test="etype!=null and etype!=''.toString()"> AND d.drsctyp = #{etype} </if>
        </if>
        <if test="deptid != null">
            AND d.deptid  IN
            <foreach item="item" index="index" collection="deptid" open="(" separator="," close=")">
                #{item}
            </foreach>

        </if>
        <if test="cultid == null">
            <if test="arttype!=null and arttype!=''.toString()"> AND d.drscarttyp LIKE "%"#{arttype}"%" </if>
            <if test="etype!=null and etype!=''.toString()"> AND d.drsctyp LIKE "%"#{etype}"%"</if>
        </if>

        <if test="province!=null and province!=''.toString()"> AND d.province = #{province} </if>
        <if test="city!=null and city!=''.toString()"> AND d.city = #{city} </if>
        <if test="area!=null and area!=''.toString()"> AND d.area = #{area} </if>
        <if test="title!=null and title!=''.toString()">  AND d.drsctitle like "%"#{title}"%" </if>

        <if test="sort!=null and sort == 1">
            <choose>
                <when test="allprovince!=null">
                    ORDER BY d.toprovince DESC, d.drscopttime DESC
                </when>
                <when test="allcity!=null">
                    ORDER BY d.tocity DESC, d.drscopttime DESC
                </when>
                <otherwise>
                    ORDER BY d.drscopttime DESC
                </otherwise>
            </choose>
        </if>
        <if test="sort==null or sort == 0">
            <choose>
                <when test="allprovince!=null">
                    ORDER BY d.toprovince DESC, d.isrecommend desc, d.drscopttime desc
                </when>
                <when test="allcity!=null">
                    ORDER BY d.tocity DESC, d.isrecommend desc, d.drscopttime desc
                </when>
                <otherwise>
                    order by d.isrecommend desc, d.drscopttime desc
                </otherwise>
            </choose>
        </if>
    </select>
</mapper>