<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong/public/resource :: copy"></head>
<body>
<link th:href="${basePath}+'/assets/style/index/index.css'" rel="stylesheet">
<script th:src="${basePath}+'/assets/js/public/sly.js'" type="text/javascript"></script>
<input type="hidden" name="history_url" th:value="${temp_url}">
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong/public/header :: copy"></div>
        <!--公共主头部结束-->
        <!--首页轮播开始-->
        <div class="banner">
            <div class="big-banner">
                <div class="banner-count">
                    <ul id="showLbt">

                    </ul>
                </div>
            </div>
            <div class="pages"></div>
        </div>
        <!--首页轮播结束-->
        <!--众筹项目开始-->
        <div class="index-module" id="ZCdemo">
            <div class="index-module-title clearfix">
                <div class="text">
                    <span>众筹项目</span>
                    <a th:href="${basePath}+'/_cultsite_/project/list'">更多 <i class="iconfont icon-enter"></i></a>
                </div>
            </div>
            <div class="index-module-content">
                <div class="index-module-list" id="zcDemoList">
                    <ul class="clearfix" id="projectList">

                    </ul>
                </div>
                <div class="pages2"></div>
            </div>
        </div>
        <!--众筹项目结束-->
        <!--众筹品牌开始-->
        <div class="index-module" id="ZCbrand">
            <div class="index-module-title clearfix">
                <div class="text">
                    <span>众筹品牌</span>
                    <a th:href="${basePath}+'/_cultsite_/brand/list'">更多 <i class="iconfont icon-enter"></i></a>
                </div>
            </div>
            <div class="index-module-content-2">
                <div class="index-module-list">
                    <ul class="clearfix" id="brandList">


                    </ul>
                </div>
            </div>
        </div>
        <!--众筹品牌结束-->
        <!--众筹资讯开始-->
        <div class="index-module index-module-bg-white" id="ZCnews">
            <div class="index-module-title clearfix">
                <div class="text">
                    <span>众筹资讯</span>
                    <a th:href="${basePath}+'/_cultsite_/news/list?id=2017101245327169'">更多 <i class="iconfont icon-enter"></i></a>
                </div>
            </div>
            <div class="index-module-content-3">
                <div class="index-module-list">
                    <ul class="clearfix" id="zczxList">


                    </ul>
                </div>
            </div>
        </div>
        <!--众筹资讯结束-->
        <!--法律法规开始-->
        <div class="index-module index-module-bg-white-end" id="ZCfagui">
            <div class="index-module-title clearfix">
                <div class="text">
                    <span>法律法规</span>
                    <a th:href="${basePath}+'/_cultsite_/fagui/list?id=2017101296841730'">更多 <i class="iconfont icon-enter"></i></a>
                </div>
            </div>
            <div class="index-module-content-3">
                <div class="index-module-list">
                    <ul class="clearfix" id="flfgList">


                    </ul>
                </div>
            </div>
        </div>
        <!--法律法规结束-->
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong/public/footer :: copy"></div>
<!--底部结束-->
<script type="text/javascript" th:inline="javascript">
    var cultsite = $.cookie("cultsite");
    $(document).ready(function () {
        $(".wrapper a").each(function(){
            var ahref = $(this).attr("href");
            if (!ahref) return true;
            if (ahref.indexOf("_cultsite_")==-1) return true;
            ahref = ahref.replace("_cultsite_", cultsite);
            $(this).attr("href", ahref);
        });

        dataInit.ajax({
            api: [[${apiPath.showAdver}]],
            fn: banner, //首页轮播图数据
            params: {
                type: 4,
                city: $.cookie('city'),
                cultid: $.cookie('cultid')
            }
        });
        dataInit.ajax({
            api: [[${apiPath.infomationList}]],
            fn: zczx, //资讯
            params: {
                index: 1,
                size: 4,
                cultid: $.cookie('cultid'),
                fromproject:"ZC",
                type:"2017101296841730" //众筹资讯
            }
        });
        dataInit.ajax({
            api: [[${apiPath.infomationList}]],
            fn: flfg, //法规
            params: {
                index: 1,
                size: 4,
                cultid: $.cookie('cultid'),
                fromproject:"ZC",
                type:"2017101245327169" //众筹法规
                }
          });
        dataInit.ajax({
            api: [[${apiPath.brandlist}]],
            fn: brandList,
            params: {
                page: 1,
                pageSize: 4,
                cultid: $.cookie('cultid')
            }
        });

        dataInit.ajax({
            api: [[${apiPath.zcProjectList}]],
            fn: projectList,
            params: {
                page: 1,
                pageSize: 12,
                cultid: $.cookie('cultid')
            }
        });

        });



    function zczx(data) {
        if (data.rows.length>0) {
            var html = '';
            for (var i = 0; i < data.rows.length; i++) {
                var model = data.rows[i];
                var line = '<li>' +
                    '<div class="time"><span class="days">'+moment(model.clnfcrttime).format('MM/DD')+'</span><span class="years">'+moment(model.clnfcrttime).format('YYYY')+'</span> </div><div class="info">' +
                    '<div class="title">'+model.clnftltle+'</div>' +
                    '<div class="text">'+model.clnfintroduce+'</div>' +
                    '<i class="iconfont icon-jiaobiao"></i>' +
                    '<a href="' + [[${basePath}]] + '/'+cultsite+ '/news/detail?id=' + model.clnfid + '" target="_blank"></a>' +
                    '</div>' +
                    '</li>';
                html = html + line;
            }
            $("#zczxList").html(html);
        }else {
            $("#ZCnews").hide();
        }
    }

    function flfg(data) {
        if (data.rows.length>0) {
            var html = '';
            for (var i = 0; i < data.rows.length; i++) {
                var model = data.rows[i];
                var line = '<li>' +
                    '<div class="time">' +
                    '<span class="days">'+moment(model.clnfcrttime).format('MM/DD')+'</span>' +
                    '<span class="years">'+moment(model.clnfcrttime).format('YYYY')+'</span>' +
                    '</div>' +
                    '<div class="info">' +
                    '   <div class="title">'+model.clnftltle+'</div>' +
                    '   <div class="text">'+model.clnfintroduce+'</div>' +
                    '   <i class="iconfont icon-jiaobiao"></i>' +
                    '   <a href="' + [[${basePath}]] + '/'+cultsite+ '/fagui/detail?id=' + model.clnfid + '" target="_blank"></a>' +
                    '</div>' +
                    '</li>';
                html = html + line;
            }
            $("#flfgList").html(html);
        }else {
            $("#ZCfagui").hide();
        }
    }

    function brandList(data) {
        if (data.rows.length>0) {
            var html = '';
            for (var i = 0; i < data.rows.length; i++) {
                var model = data.rows[i];
                var line = '';
                if(i%2 == 0){
                    line = '<li>' +
                        '<div class="top-title">' +
                        '<div class="text">' + model.title + '</div>' +
                        '<span class="line"></span>' +
                        '</div>' +
                        '<div class="bottom-img">' +
                        '<a href="javascript:void(0)">' +
                        '<img src="' + data.imgPath + model.imgurl + '">' +
                        '</a></div>' +
                        '<a href="' + [[${basePath}]] + '/'+cultsite+ '/brand/detail?id=' + model.id + '" target="_blank"></a>'+
                    '</li>';
                }else {
                    line = '<li class="even">' +
                        '<div class="bottom-img">' +
                        '<a href="javascript:void(0)">' +
                        '<img src="' + data.imgPath + model.imgurl + '">' +
                        '</a></div>' +
                        '<div class="top-title">' +
                        '<div class="text">' + model.title + '</div>' +
                        '<span class="line"></span>' +
                        '</div>' +
                        '<a href="' + [[${basePath}]] + '/'+cultsite+ '/brand/detail?id=' + model.id + '" target="_blank"></a>'+
                    '</li>';
                }

                html = html + line;
            }
            $("#brandList").html(html);
        }else {
            $("#ZCbrand").hide();
        }
    }




    function projectList(data) {
        if (data.rows.length>0) {
            var html = '';
            var dataNow = data.data.now;
            var len=0;
            for (var i = 0; i < data.rows.length; i++) {
                len++;
                var model = data.rows[i];
                var imgPath = [[${imgPath}]] + dataInit.getSmallImage(model.imgurl);
                //获得众筹达成率
                var _DCl = parseInt((model.orderCount/model.nummin)*100);
                _DCl = _DCl>100 ? 100 : _DCl;
                //获得众筹剩余份数
                var _ZC_Max = model.numsum - model.orderCount;
                _ZC_Max = _ZC_Max<0 ? 0 : _ZC_Max;
                //获取剩余天数
                var SY_Days = getDays(model.timeend,dataNow,model.timestart);
                var _href_detail = '';
                if(model.etype == 4){
                    _href_detail = 'project/actdetail?id='+model.id;
                }else if(model.etype == 5) {
                    _href_detail = 'project/traindetail?id='+model.id;
                }else if(model.etype == 0){
                    _href_detail = 'project/otherdetail?id='+model.id;
                }else {
                    _href_detail = 'project/otherdetail?id='+model.id;
                }
                var line ='';
                if(len%4==1){
                    line+='<li><ul>';
                }
                line+='<li><div class="img">';
                line+='<a href="'+_href_detail+'" target="_blank">';
                line+=' <img src="'+imgPath+'"></a>';
                line+='</div><div class="info"><div class="title">'+model.title+'</div>';
                line+='<div class="progress-bar"><span data-progress-bar="'+_DCl+'"></span></div>';
                line+='<div class="progress-table clearfix">';
                line+='<div class="progress-table-list"><span>'+_DCl+'%</span>';
                line+='<span class="text">达成率</span></div>';
                line+='<div class="progress-table-list"><span>'+_ZC_Max+'</span>';
                line+='<span class="text">剩余份数</span></div>';
                line+='<div class="progress-table-list no-border"><span>'+SY_Days+'</span>';
                line+='<span class="text">剩余时间</span></div></div></div>';
                line+='<a href="'+_href_detail+'" target="_blank"></a></li>';


                if(len==data.rows.length){
                    line += '</ul></li>';
                }else {
                    if (len % 4 == 0) {
                        line += '</ul></li>';
                    }
                }
                html = html + line;
            }
            $("#projectList").html(html);
            if(data.rows.length>0){
                $("#zcDemoList").sly({
                    horizontal: 1,
                    itemNav: 'forceCentered',
                    //cycleBy: 'items',
                    pagesBar: ".pages2",
                    startAt: 1,
                    pageBuilder:function (dom) {
                        return "<span></span>";
                    }
                    //,cycleInterval: 5000
                });
            }
            setTimeout(function () {
                //进度条动画
                $(".progress-bar span").each(function () {
                    var bar_size = $(this).attr("data-progress-bar");
                    $(this).css("width",bar_size+"%");
                })
            },200)
        }else {
            $("#ZCdemo").hide();
        }
    }


    //获取剩余天数
    function getDays(timeend,_dataNow,timestart) {
        if(_dataNow>timeend){
            return '已结束';
        }else if(_dataNow>timestart){
            return moment(timeend).fromNow(true);
        }else {
            return '未开始';
        }
    }

    function banner(data) {
        if (data.rows.length && data.code == 0) {
            for (var i = 0; i < data.rows.length; i++) {
                if(data.rows[i].url&&data.rows[i].url!=""){
                    $("#showLbt").append('<li style="background-image:url(' + data.imgPath + data.rows[i].picture + ')"><a href="' + data.rows[i].url + '"></a></li>');
                }else{
                    $("#showLbt").append('<li style="background-image:url(' + data.imgPath + data.rows[i].picture + ')"><a href="javascript:void(0)"></a></li>');
                }
            }
            if(data.rows.length>0){
                $(".banner-count").sly({
                    itemNav: "forceCentered",
                    easing: "easeOutExpo",
                    pagesBar: ".pages",
                    pageBuilder:function (dom) {
                        return "<span></span>";
                    },
                    cycleBy: 'items',
                    horizontal: 1,
                    cycleInterval: 5000
                });
            }
        } else {
            var Banner_basePath = [[${basePath}]] + '/assets/img/img_demo/zc_banner.jpg';
            $("#showLbt").append('<li style="background-image:url(' + Banner_basePath + ')"><a href="javascript:void(0)"></a></li>');
        }
    }
</script>
</body>
</html>