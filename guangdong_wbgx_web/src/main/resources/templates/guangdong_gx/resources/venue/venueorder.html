<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong_gx/public/resource :: copy"></head>
<body>
<link rel="stylesheet" th:href="${basePath}+'/assets/style/venue/venueOrder.css'">
<script th:src="${basePath}+'/assets/common/js/whg.maps.js'"></script>
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong_gx/public/header :: copy"></div>
        <!--公共主头部结束-->
        <div class="sys-crumbs">
            <span><a href="../index">首页</a></span>
            <i class="icon iconfont icon-enter"></i>
            <span><a href="list">场馆</a></span>
            <i class="icon iconfont icon-enter"></i>
            <span><a href="javascript:void(0);" id="venueName"></a></span>
            <i class="icon iconfont icon-enter"></i>
            <span class="active _title" id="crumbs-title"></span>
        </div>
        <div class="sys-main-info">
            <div class="img">
                <img id="imgPath" src="../../assets/img/public/loading.png">
            </div>
            <div class="info">
                <h1 class="_title" id="title">&nbsp;</h1>
                <p class="tag-list" id="tag"></p>
                <p class="desc">
                    供需次数：<span class="stars-list">
                    </span>
                </p>
                <p class="desc">
                    所属文化馆：<span id="venue"></span>
                </p>
                <p class="desc">
                    联系人：<span id="contacts"></span>
                </p>
                <p class="desc">
                    联系电话：<span id="phone"></span>
                </p>
                <p class="desc">
                    可用面积：<span id="sizearea"></span>
                </p>
                <p class="desc">
                    容纳人数：<span id="sizepeople"></span>
                </p>
                <p class="desc">
                    是否收费：<span id="charge"></span>
                </p>
                <p class="desc">
                    场馆地址：<span id="venueAddress"></span>
                </p>
                <p class="desc">
                    类型：<span id="etype"></span>
                </p>
                <p class="desc">
                    关键字：<span id="ekey"></span>
                </p>
                <div class="go-next"><a href="#timeList">申请配送</a></div>
                <div class="other-cont clearfix">
                    <div class="fav-vote-cont clearfix">
                        <div class="sys-fav" title="收藏"><i
                                class="icon iconfont icon-collection icon-collection_fill" id="fav-btn"></i><span>0</span></div>
                    </div>
                    <div class="sns-cont" title="分享">
                        分享到
                        <a href="javascript:void(0);"  class="fxweix"><i
                                class="icon iconfont icon-wechat"></i></a>
                        <a href="javascript:void(0);"  class="fxweibo"><i
                                class="icon iconfont icon-xinlang"></i></a>
                        <a href="javascript:void(0);"  class="fxqq"><i
                                class="icon iconfont icon-kongjian"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="room-date-change-cont" id="roomTime" style="display: none">
            <div class="main-cont clearfix">
                <div class="sys-main-title">
                    <div class="title">活动室预定</div>
                    <hr>
                </div>
                <div class="left-cont">
                    <div class="orderPayCont">
                        <div class="dateCont clearfix">
                            <div class="weekCont clearfix">
                                <div class="week-btn week-prev"></div>
                                <div class="week-groups">
                                    <ul></ul>
                                </div>
                                <div class="week-btn week-next"></div>
                            </div>

                        </div>
                        <div class="tableListCont">
                            <table>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <div class="orderPayBg">
                            <div class="orderPay"><a href="javascript:void(0)">立即预订</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sys-main-bottom">
            <div class="main-cont clearfix">
                <div class="left-cont">
                    <div class="item-cont" id="show-venue-info">
                        <div class="sys-main-title">
                            <div class="title">活动室详情</div>
                            <hr>
                        </div>
                        <div class="sys-detail-list">
                            <div class="title">活动室简介</div>
                            <div class="html-panel" id="summary"></div>
                        </div>
                        <div class="sys-detail-list" id="crowd">
                            <div class="title">适宜人群</div>
                            <div class="html-panel" ></div>
                        </div>
                        <div class="sys-detail-list">
                            <div class="title">设备描述</div>
                            <div class="html-panel" id="facilitydesc"></div>
                        </div>
                        <!--<div class="sys-detail-list" id="rangeContent">
                            <div class="title">配送范围</div>
                            <div class="html-panel" id="range"></div>
                        </div>-->
                        <div class="sys-detail-list">
                            <div class="title">配送时间</div>
                            <div class="html-panel">
                                <div class="dg-train-info dg-train-table" style="margin-bottom: 20px">
                                    <table>
                                        <tbody id="timeList">
                                        </tbody>
                                    </table>
                                </div>
                                <!--分页开始-->
                                <div class="green-black" id="artPagging" style="margin-bottom: 40px"></div>
                                <!--分页结束-->
                            </div>
                        </div>
                        <div class="sys-detail-list" id="rangeMemo">
                            <div class="title">配送说明</div>
                            <div class="html-panel" id="memo"></div>
                        </div>
                        <!--资源-->
                        <div class="sys-detail-list" id="res-cont">
                            <div class="title">相关资源：</div>
                            <div class="html-panel">
                                <div class="res-detail-cont">
                                    <div class="res-filter">
                                        <div class="filter-list">
                                            <div class="clearfix" id="fileter-nav">
                                                <span onclick="resDate(1)"class="active"><a href="javascript:void(0)">图片</a></span>
                                                <span onclick="resDate(2)"><a href="javascript:void(0)">视频</a></span>
                                                <span onclick="resDate(3)"><a href="javascript:void(0)">音频</a></span>
                                                <span onclick="resDate(4)"><a href="javascript:void(0)">文档</a></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="style-list">
                                        <div class="content-list">
                                            <ul class="clearfix" id="modelList_2"></ul>
                                        </div>
                                        <!--分页开始 -->
                                        <div class="green-black" id="artPagging_2" style="margin-bottom: 40px"></div>
                                        <!--分页结束-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="right-cont">
                    <div class="item-cont">
                        <div class="sys-main-title">
                            <div class="title">相关活动室</div>
                            <hr>
                        </div>
                        <div class="recommend-cont">
                            <ul id="RecommendRoomList">
                                <!--<li>
                                    <div class="img">
                                        <a href="#">
                                            <img src="../../assets/img/img_demo/demo2017b.jpg">
                                        </a>
                                    </div>
                                    <p>
                                        <a href="#">不过话说text-ellipsis是一个特殊的样式</a>
                                    </p>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong_gx/public/footer :: copy"></div>
<!--底部结束-->
<input type="hidden" id="temp_type" value="3">
<div th:include="guangdong_gx/public/fav :: copy"></div>
<script th:src="${basePath}+'/assets/js/plugins/roll/jquery.sly.min.js'"></script>
<script th:src="${basePath}+'/assets/js/field/fieldOrder.js'"></script>
<script th:src="${basePath}+'/assets/js/field/roomOrderTool.js'"></script>
<script type="text/javascript" th:inline="javascript">
    var itemId = dataInit.getUrlParam('id');
    var address, longitude, latitude;
    var crtuser = '';
    var userid = $("#temp_userId").val();
    var _title = '';
    $(document).ready(function () {
        resDate();
        $("#fileter-nav span").on('click',function(){
            $(this).addClass('active').siblings().removeClass('active');
        })

        dataInit.ajax({
            api: [[${apiPath.resCgRoomInfo}]],
            fn: function (data) {
                showRoomDetail(data);
                ShowApplyTimes.init({
                    basePath: [[${basePath}]],
                    apiUrl: [[${apiPath.supplyTimeList}]],
                    supplyId: itemId,
                    supplyType: '1',
                    fav_type: fav_type,
                    crtuser: crtuser,
                    title: _title,
                    userId: userid
                });
            },
            params: {id: itemId}
        });
        /*dataInit.ajax({
            api: [[${apiPath.canApply}]],
            fn: function (data) {
                if(data.data == true){
                    $(".go-next").on("click",function () {
                        window.location.href = [[${basePath}]]+'/res-center/stepOpenDay?id=' + itemId +'&fktype='+fav_type+ '&crtuser='+crtuser+'&title='+encodeURI(encodeURI(_title));
                    })
                }else {
                    $(".go-next").hide();
                }
            },
            params: {id: itemId}
        });*/
        dataInit.ajax({
            api: [[${apiPath.resCgRefRoomList}]],
            fn: refRoomList,
            params: {id: itemId, size:3,cultid: $.cookie('cultid')}
        });
         //供需指数 星星
        dataInit.ajax({
            api: [[${apiPath.showStarts}]],
            fn: showStarts,
            params: {id: itemId}
        });
        //供需配送时间列表
        //showTimeList();

        //供需配送范围
        /*dataInit.ajax({
            api: [[${apiPath.getCitys4resource}]],
            fn: supplyGetGxCity,
            params: {id: itemId}
        });*/

        $(".colse-map").on('click', function () {
            dom.hide();
            $(".window-mask").hide();
        })
    });
    function showRoomDetail(data) {
        var venueName = data.data.venTitle;
        $("#venueName").text(venueName);
        $("#venueName").attr("href", "venuedetail?id=" + data.data.venid);

        var RoomList = data.data;
        var title = RoomList.title;
        var phone = RoomList.phone;
        //address = RoomList.address + RoomList.location;
        address = RoomList.location;
        var sizearea = RoomList.sizearea;// + '㎡';
        var sizepeople = RoomList.sizepeople + '人';
        var memo = RoomList.notice;
        if(memo&&memo!=""){
            $('#memo').html(memo);
        }else{
            $('#rangeMemo').hide();
        }
        var imgPath = data.imgPath + dataInit.getBigImage(RoomList.imgurl);
        crtuser  = RoomList.crtuser;
        /*if(!(userid!=""&&crtuser!=""&&crtuser!=userid)){
            $(".go-next").hide();//信息发布者与申请配送者不能一致
        }*/
        _title  = title;
        //调分享接口
        dataInit.share(title, imgPath);
        //标签
        if (RoomList.etag) {
            var tag = RoomList.etag.split(",");
            var tagHtml = "";
            for (var j in tag) {
                tagHtml += '<span>' + tag[j] + '</span>';
            }
            $("#tag").html(tagHtml);
        }
        /*else {
         $("#tag").hide();
         }*/
        //设施
        /*if (RoomList.facility) {
            var facility = RoomList.facility.split(",");
            var facilityHtml = "配套设施：";
            for (var j in facility) {
                facilityHtml += '<span class="tag">' + facility[j] + '</span>';
            }
            $("#facility").html(facilityHtml);
        } else {
            $("#facility").hide();
        }*/

        /*$("#timeList").empty();
        var activeTime = moment(RoomList.pstimestart).format('YYYY-MM-DD');
        var endTime = moment(RoomList.pstimeend).format('YYYY-MM-DD');
        var TimeListHtml = '<tr>' +
                '<td class="not-conform">1</td>' +
                '<td class="not-conform">' + activeTime + '</td>' +
                '<td class="not-conform">' + endTime + '</td>' +
                '</tr>';
        $("#timeList").html(TimeListHtml);*/

        //$("#range").html(RoomList.pscity);
        if (!RoomList.facility || RoomList.facility==''){
            $("#facilitydesc").parent(".sys-detail-list").hide();
        }else{
            $("#facilitydesc").html(RoomList.facility);
        }

        //var description = RoomList.description;

        //获取经纬度
        longitude = RoomList.longitude;
        latitude = RoomList.latitude;
        WhgMap.showMap('map-box', address, longitude, latitude);
        //$('#description').html(description);
        var summary = RoomList.summary;
        $('#summary').html(summary);
        var crowd = RoomList.crowd;
        if (crowd){
            $("#crowd").find(".html-panel").text(crowd);
        }else{
            $("#crowd").hide();
        }

        $('._title').text(title);
        $('#phone').text(phone);
        $('#address').text(address);
        $('#sizearea').text(sizearea);
        $('#sizepeople').text(sizepeople);
        $('#venue').text(RoomList.venCultTitle);
        $('#contacts').text(RoomList.contacts);
        $('#charge').text(RoomList.hasfees?'收费':'免费');
        $('#venueAddress').text(RoomList.address +' '+ RoomList.location);
        $('#etype').text(RoomList.etype);

        var ekey = RoomList.ekey;
        if (ekey && ekey!=''){
            $('#ekey').text(ekey);
        }else{
            $('#ekey').parent("p.desc").hide();
        }



        $('#imgPath').attr('src', imgPath);
        var labelList = RoomList.facility;
        setTimeout(function () {
            if (labelList && labelList.length > 0)
                labelList = labelList.split(",");
            var labelListHtml = '';
            if (labelList) {
                for (var j in labelList) {
                    var text = dataInit.checkDict(labelList[j]);
                    labelListHtml += '<em>' + text + '</em>';
                }
            } else {
                $("#sheshi").remove();
            }
            $('#labelList').html(labelListHtml);
        }, 0);

    }
    function refRoomList(data) {
        //相关活动室
        $("#RecommendRoomList").empty();
        var roomlist = data.rows;
        if (roomlist && roomlist.length > 0) {
            var i_length = roomlist.length > 3 ? 3 : roomlist.length;
            for (var i = 0; i < i_length; i++) {
                var imgPathR = data.imgPath + dataInit.getBigImage(roomlist[i].imgurl);
                if (roomlist[i].id != itemId) {
                    $("#RecommendRoomList").append(
                        '<li>' +
                        '<div class="img">' +
                        '<a href="venueorder?id=' + roomlist[i].id + '">' +
                        '<img src="' + imgPathR + '">' +
                        '</a>' +
                        '</div>' +
                        '<p>' +
                        '<a href="venueorder?id=' + roomlist[i].id + '">' + roomlist[i].title + '</a>' +
                        '</p>' +
                        '</li>'
                    );
                }
            }
        } else {
            $("#RecommendRoomList").append('<div class="public-no-message-detail"></div>');
        }
    }
    /*function showTimeList(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 10;
        //page pageSize  cultid  type  styletype
        var params = {
            page: params_page,
            pageSize: params_rows,
            id: itemId
        }
        dataInit.ajax({
            api: [[${apiPath.supplyTimeList}]],
            fn: function (data) {
                timeList(data, params.page, params.pageSize);
                dataInit.pageInit('artPagging', params_page, params_rows, data.total, showTimeList);
            },
            params: params
        });
    }
    function timeList(data, page, pageSize) {
        if(data.code == 0 && data.rows.length>0){
            var _timeList = data.rows;
            if(!_timeList.length || data.total<= pageSize){
                $("#artPagging").hide();
            }
            $("#timeList").empty();
            var TimeListHtml = "";
            TimeListHtml += '<tr>' +
                '<th class="not-conform">序号</th>' +
                '<th class="not-conform">配送开始时间</th>' +
                '<th class="not-conform">配送结束时间</th>' +
                '<th class="not-conform">是否收费</th>' +
                '<th class="not-conform">配送范围</th>' +
                '<th class="not-conform"></th>' +
                '</tr>';
            for (var i in _timeList) {
                var activeTime = moment(_timeList[i].timestart).format('YYYY-MM-DD HH:mm:ss');
                var endTime = moment(_timeList[i].timeend).format('YYYY-MM-DD HH:mm:ss');
                var hasfees = (_timeList[i].hasfees && _timeList[i].hasfees ==1)? '是' : '否';
                var j = parseInt(i) + 1 + (page-1)*pageSize;
                TimeListHtml += '<tr>' +
                    '<td class="not-conform">' + j + '</td>' +
                    '<td class="not-conform">' + activeTime + '</td>' +
                    '<td class="not-conform">' + endTime + '</td>' +
                    '<td class="not-conform">' + hasfees + '</td>' +
                    '<td class="not-conform">' + _timeList[i].pscity + '</td>' +
                    '<td class="not-conform">申请配送</td>' +
                    '</tr>';
            }
            $("#timeList").html(TimeListHtml);
        }else {
            rongDialog.init({
                ico : 2, //1 勾  2 叉
                type : 1,
                desc : data.msg
            });
        }
    }*/
    /*function supplyGetGxCity(data) {
        if( data.code == 0 && data.data){
            $("#range").html(data.data.city);
        }else {
            $("#rangeContent").hide();
        }
    }*/


    //获取资源数据
    function resDate(type){
        var enttype = type ? type : 1;
        dataInit.ajax({
            api:[[${apiPath.resourceList}]],
            params:{
                refid:itemId,
                reftype:3,
                enttype:enttype
            },
            fn:function(data){
                showResList(data,enttype);
            }
        })
    }
    //生成资源列表
    function showResList(data,type){
        var modelUL = $("#modelList_2");
        var type = type+"";
        modelUL.empty();
        if(data.code == 0){
            if (data.data.length > 0) {
                for (var i in data.data) {
                    var module = data.data[i];
                    var html = $('<li>\
                                    <div class="img">\
                                        <img >\
                                    </div>\
                                    <div class="info">\
                                        <div class="title">'+module.name+'</div>\
                                    </div>\
                                    <div class="mask"><img></div>\
                                    <a href="javascript:void(0)"></a>\
                                    </li>');
                    if(module.enturl){
                        var _enturl = module.enturl.indexOf('http') >= 0 ? module.enturl : data.imgPath + module.enturl;
                    }
                    var resBasePath = [[${basePath}]];
                    switch (type){
                        case "1" : //图片
                            html.find(".img img").attr("src", dataInit.getRemoteURL(data.imgPath , dataInit.getMidImage(module.enturl)));
                            html.find(".mask").empty();
                            html.find("a:last").attr("onClick", "rongDialog.init({\
                                            ico : 1,\
                                            type : 6,\
                                            imgUrl : '"+_enturl+"',\
                                            title : '"+ module.name +"'\
                                        });"
                            );
                            break;
                        case "2" :  //视频
                            html.find(".img img").attr("src", dataInit.getRemoteURL(data.imgPath , dataInit.getMidImage(module.deourl)));
                            html.find(".mask img").attr("src", [[${basePath}]] + '/assets/img/brand/play.png');
                            html.find("a:last").attr("onClick", "rongDialog.init({\
                                            type : 5,\
                                            vedioUrl : '"+_enturl+"',\
                                            vedioImg : '',\
                                            vedioTitle : '"+module.name+"',\
                                            basePath : '"+resBasePath+"'\
                                        })"
                            );
                            break;
                        case "3" :  //音频
                            //alert(resBasePath+"/assets/img/brand/brand-music.jpg");
                            html.find(".img img").attr("src", [[${basePath}]] + '/assets/img/brand/brand-music.jpg');
                            html.find(".mask img").attr("src", [[${basePath}]] + '/assets/img/brand/macphone.png');
                            html.find("a:last").attr("onClick", "rongDialog.init({\
                                            type : 5,\
                                            vedioUrl : '"+_enturl+"',\
                                            vedioype : 'mp3',\
                                            vedioImg : '"+resBasePath+"/assets/img/brand/brand-music.jpg',\
                                            vedioTitle : '"+module.name+"',\
                                            basePath : '"+resBasePath+"'\
                                        });setWidth();"
                            );
                            break;

                        case "4" : //文档
                        //html.find(".img img").attr("src", [[${basePath}]] + '/assets/img/brand/xiazai.jpg');
                            var iconImg = dataInit.getFileTypeIcon(module.enturl, '/assets/img/brand/xiazai.jpg');
                            html.find(".img img").attr("src", [[${basePath}]] + iconImg);

                        html.find(".mask").empty();
                        html.find("a:last").attr({
                            target:"_blank",
                            href: dataInit.getRemoteURL(data.imgPath , module.enturl)
                        });
                        break;

                        default:
                            html.find(".mask").empty();
                    }
                    modelUL.append(html);
                }
            } else {
                modelUL.append("<div class='public-no-message'></div>");
            }
        }else {
            $("#res-cont").hide();
        }
    }


    $(function(){
        var showDeliveryUrl = [[${apiPath.showDelivery}]];
        ShowApplyList.init(showDeliveryUrl, dataInit.getUrlParam('id'));
    });
</script>
<script th:src="${basePath}+'/assets/common/js/showapplylist.js'"></script>
<script th:src="${basePath}+'/assets/common/js/showapplytimes.js'"></script>
</body>
</html>