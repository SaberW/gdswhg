<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong_gx/public/resource :: copy"></head>
<body>
<script th:src="${basePath}+'/assets/common/js/whg.maps.js'"></script>
<script th:src="${basePath}+'/assets/js/public/sly.js'"></script>
<script type="text/javascript">
    $(function(){
        $('a[href*=#],area[href*=#]').click(function() {
            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
                var $target = $(this.hash);
                $target = $target.length && $target || $('[name=' + this.hash.slice(1) + ']');
                if ($target.length) {
                    var targetOffset = $target.offset().top;
                    $('html,body').animate({
                            scrollTop: targetOffset
                        },
                        400);
                    return false;
                }
            }
        });
    })
</script>
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong_gx/public/header :: copy"></div>
        <!--公共主头部结束-->
        <div class="sys-crumbs">
            <span><a href="../res-gx/index">首页</a></span>
            <i class="icon iconfont icon-enter"></i>
            <span><a href="list">培训</a></span>
            <i class="icon iconfont icon-enter"></i>
            <span class="active" id="title"></span>
        </div>
        <div class="sys-main-info">
            <div class="img">
                <img id="imgPath" src="../../assets/img/public/loading.png">
            </div>
            <div class="info">
                <h1 class="_title">&nbsp;</h1>
                <p class="tag-list" id="tag">
                </p>
                <!--<p class="desc">
                    开放时间：<span>周一至周五 09:00至22:00</span>
                </p>-->
                <p class="desc">
                    供需次数：<span class="stars-list">
                    </span>
                </p>
                <p class="desc" id="venue_desc">
                    所属文化馆：<span id="venue">&nbsp;</span>
                </p>
                <p class="desc" id="contacts_desc">
                    联系人：<span id="contacts">&nbsp;</span>
                </p>
                <p class="desc" id="phone_desc">
                    联系电话：<span id="phone">&nbsp;</span>
                </p>
                <p class="desc" id="charge_desc">
                    是否收费：<span id="charge">&nbsp;</span>
                </p>
                <p class="desc" id="islive_desc">
                    培训方式：<span id="islive">&nbsp;</span>
                </p>
                <p class="desc" id="trainTime_desc">
                    培训时长：<span id="trainTime">&nbsp;</span><!--小时-->
                </p>
                <p class="desc" id="period_desc">
                    培训周期：<span id="period">&nbsp;</span>
                </p>
                <p class="desc" id="fitcrowd_desc">
                    合适人群：<span id="fitcrowd">&nbsp;</span>
                </p>

                <div class="go-next"><a href="#timeList">申请配送</a></div>
                <div class="other-cont clearfix">
                    <div class="fav-vote-cont clearfix">
                        <div class="sys-fav" title="收藏"><i class="icon iconfont icon-collection icon-collection_fill" id="fav-btn"></i><span>0</span></div>
                    </div>
                    <!--<div class="sns-cont" title="分享">
                        分享到
                        <a href="javascript:void(0);"  class="fxweix"><i class="icon iconfont icon-wechat"></i></a>
                        <a href="javascript:void(0);"  class="fxweibo"><i class="icon iconfont icon-xinlang"></i></a>
                        <a href="javascript:void(0);"  class="fxqq"><i class="icon iconfont icon-kongjian"></i></a>
                    </div>-->
                </div>
            </div>
        </div>
        <div class="sys-main-bottom">
            <div class="main-cont clearfix">
                <div class="left-cont">
                    <div class="item-cont" id="show-venue-info">
                        <div class="sys-main-title">
                            <div class="title">供需信息内容</div>
                            <hr>
                        </div>
                        <div class="sys-detail-list">
                            <div class="title">课程简介</div>
                            <div class="html-panel" id="summary"></div>
                        </div>
                        <div class="sys-detail-list">
                            <div class="title">课程内容</div>
                            <div class="html-panel" id="description"></div>
                        </div>
                       <!-- <div class="sys-detail-list">
                            <div class="title">老师介绍</div>
                            <div class="html-panel" id="teacher"></div>
                        </div>-->

                        <!--<div class="sys-detail-list" id="rangeContent">
                            <div class="title">配送范围</div>
                            <div class="html-panel" id="range"></div>
                        </div>-->
                        <div class="sys-detail-list">
                            <div class="title">配送时间</div>
                            <div class="html-panel">
                                <div class="dg-train-info dg-train-table" style="margin-bottom: 20px">
                                    <table>
                                        <tbody id="timeList">
                                        </tbody>
                                    </table>
                                </div>
                                <!--分页开始-->
                                <div class="green-black" id="artPagging" style="margin-bottom: 40px"></div>
                                <!--分页结束-->
                            </div>
                        </div>
                        <div class="sys-detail-list" id="rangeMemo">
                            <div class="title">配送说明</div>
                            <div class="html-panel" id="memo"></div>
                        </div>
                        <!-- -->
                        <div class="sys-detail-list" id="yjpz">
                            <div class="title">硬件配置</div>
                            <div class="html-panel">
                                <div class="dg-train-info dg-train-table" style="margin-bottom: 20px">
                                    <table>
                                        <tbody id="yjpzList">
                                        </tbody>
                                    </table>
                                </div>
                                <!--分页开始-->
                                <div class="green-black" id="yjpzPagging" style="margin-bottom: 40px"></div>
                                <!--分页结束-->
                            </div>
                        </div>
                        <!-- -->
                        <div class="sys-detail-list" id="pxry">
                            <div class="title">主讲老师</div>
                            <div class="html-panel">
                                <div class="dg-train-info dg-train-table" style="margin-bottom: 20px">
                                    <table>
                                        <tbody id="pxryList">
                                        </tbody>
                                    </table>
                                </div>
                                <!--分页开始-->
                                <div class="green-black" id="pxryPagging" style="margin-bottom: 40px"></div>
                                <!--分页结束-->
                            </div>
                        </div>

                        <!--资源-->
                        <div class="sys-detail-list" id="res-cont">
                            <div class="title">相关资源：</div>
                            <div class="html-panel">
                                <div class="res-detail-cont">
                                    <div class="res-filter">
                                        <div class="filter-list">
                                            <div class="clearfix" id="fileter-nav">
                                                <span onclick="resDate(1)"class="active"><a href="javascript:void(0)">图片</a></span>
                                                <span onclick="resDate(2)"><a href="javascript:void(0)">视频</a></span>
                                                <span onclick="resDate(3)"><a href="javascript:void(0)">音频</a></span>
                                                <span onclick="resDate(4)"><a href="javascript:void(0)">文档</a></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="style-list">
                                        <div class="content-list">
                                            <ul class="clearfix" id="modelList_2"></ul>
                                        </div>
                                        <!--分页开始 -->
                                        <div class="green-black" id="artPagging_2" style="margin-bottom: 40px"></div>
                                        <!--分页结束-->
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="right-cont">
                    <div class="item-cont">
                        <div class="sys-main-title">
                            <div class="title">相关推荐</div>
                            <hr>
                        </div>
                        <div class="recommend-cont">
                            <ul id="Recommend">
                                <!--<li>
                                    <div class="img">
                                        <a href="#">
                                            <img src="../../assets/img/img_demo/demo2017b.jpg">
                                        </a>
                                    </div>
                                    <p>
                                        <a href="#">不过话说text-ellipsis是一个特殊的样式</a>
                                    </p>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong_gx/public/footer :: copy"></div>
<!--底部结束-->
<input type="hidden" id="temp_type" value="5">
<div th:include="guangdong_gx/public/fav :: copy"></div>
<a class="to-top"></a>
<script th:src="${basePath}+'/assets/js/field/fieldOrder.js'"></script>
<script type="text/javascript" th:inline="javascript">
    var itemId = dataInit.getUrlParam('id');
    var crtuser = '';
    var userid = $("#temp_userId").val();
    var _title = '';
    $(document).ready(function () {
        resDate();
        $("#fileter-nav span").on('click',function(){
            $(this).addClass('active').siblings().removeClass('active');
        })
        /*dataInit.ajax({
            api: [[${apiPath.canApply}]],
            fn: function (data) {
                if(data.data == true){
                        $(".go-next").on("click",function () {
                            window.location.href = [[${basePath}]]+'/res-center/stepOpenDay?id=' + itemId +'&fktype='+fav_type+ '&crtuser=' +crtuser+'&title='+encodeURI(encodeURI(_title));
                        })
                }else {
                    $(".go-next").hide();
                }
            },
            params: {id: itemId}
        });*/
        //培训信息
        dataInit.ajax({
            api: [[${apiPath.resPxInfo}]],
            fn: function(data){
                showVenueDetail(data);
                ShowApplyTimes.init({
                    basePath: [[${basePath}]],
                    apiUrl: [[${apiPath.supplyTimeList}]],
                    supplyId: itemId,
                    supplyType: '2',
                    fav_type: fav_type,
                    crtuser: crtuser,
                    title: _title,
                    userId: userid
                });
            },
            params: {id: itemId}
        });
        //供需指数 星星
        dataInit.ajax({
            api: [[${apiPath.showStarts}]],
            fn: showStarts,
            params: {id: itemId}
        });
        //推荐培训列表
        dataInit.ajax({
            api: [[${apiPath.recommendTraList}]],
            fn: recommendList,
            params: {traid: itemId, size:3,cultid: $.cookie('cultid')}
        });

        //供需配送时间列表
        //showTimeList();
        showYjpzList();
        showpxryList();
        //供需配送范围
//        dataInit.ajax({
//            api: [[${apiPath.getCitys4resource}]],
//            fn: supplyGetGxCity,
//            params: {id: itemId}
//        });
    });

    var latitude = 	'39.915177',longitude = '116.403887',venueAddress,model,roomLength;

    function showVenueDetail(data) {
        if(data && data.code == 0){
            model = data.data;
            var phone = model.phone;
            var address = model.address;
            var title = model.title;
            var contacts = model.contacts;
            var venue = model.cultname;
            var type = model.etag;
            var summary = model.outline;
            var coursedesc = model.coursedesc;
            var range = model.pscity;
            var teacherdesc = model.teacherdesc;
            var imgPath = data.imgPath + dataInit.getBigImage(model.image);
            crtuser = model.crtuser;
            /*if(!(userid!=""&&crtuser!=""&&crtuser!=userid)){
                $(".go-next").hide();//信息发布者与申请配送者不能一致
            }*/
            _title = title;
            //调分享接口
            dataInit.share(title,imgPath);
            var memo = model.notice;
            if(memo&&memo!=""){
                $('#memo').html(memo);
            }else{
                $('#rangeMemo').hide();
            }
            $('#summary').html(coursedesc);
            $('#description').html(summary);
            $('#teacher').html(teacherdesc);
            if(phone){
                $('#phone').text(phone);
            }else {
                $('#phone_desc').hide();
            }

            $('#range').html(range);

            $('#address').text(address);

            if(contacts){
                $('#contacts').text(contacts);
            }else {
                $('#contacts_desc').hide();
            }
            if(venue){
                $('#venue').text(venue);
            }else {
                $('#venue_desc').hide();
            }

            if(type){
                $('#type').text(type);
            }else {
                $('#type_desc').hide();
            }

            $('#title,._title').text(title);
            $('#imgPath').attr('src',imgPath);

            var tag = model.typename.split(",");
            var tagHtml = "";
            for(var j in tag){
                tagHtml+='<span>'+tag[j]+'</span>';
            }
            $("#tag").html(tagHtml);

            //是否收费
            if(model.ismoney == 0){
                $("#charge").text("不收费");
            }else {
                $("#charge").text("收费");
            }

            //培训时长
            if(model.duration){
                $('#trainTime').text(model.duration);
            }else {
                $('#trainTime').parent("p.desc").hide();
            }
            if(model.islive){
                var islive = model.islive.replace('0', "线上").replace('1',"线下");
                $('#islive').text(islive);
            }else {
                $('#islive').parent("p.desc").hide();
            }
            if(model.period){
                $('#period').text(model.period);
            }else {
                $('#period').parent("p.desc").hide();
            }
            if(model.fitcrowd){
                $('#fitcrowd').text(model.fitcrowd);
            }else {
                $('#fitcrowd').parent("p.desc").hide();
            }

            //获取经纬度
            if(model.latitude)
                latitude = Number(model.latitude);
            if(model.longitude)
                longitude = Number(model.longitude);
            venueAddress = model.address;
            WhgMap.showMap('maps_ven_target', venueAddress, longitude, latitude);
        }else {
            rongDialog.init({
                ico : 2, //1 勾  2 叉
                type : 1,
                desc : data.msg
            });
        }

    }
    function recommendList(data) {
        //推荐列表
        var tjvenlist = data.rows;
        $("#Recommend").empty();
        if(tjvenlist && tjvenlist.length){
            var i_length = tjvenlist.length>3 ? 3 : tjvenlist.length;
            for (var i=0;i<i_length;i++) {
                var imgPathT = data.imgPath + dataInit.getBigImage(tjvenlist[i].image);
//                var endTime = moment(tjvenlist[i].statemdfdate).format('YYYY-MM-DD');
                if(tjvenlist[i].id != itemId){
                    $("#Recommend").append(
                        '<li>'+
                        '<div class="img">'+
                        '<a href="detail?id='+tjvenlist[i].id+'">'+
                        '<img src="'+imgPathT+'">'+
                        '</a>'+
                        '</div>'+
                        '<p>'+
                        '<a href="detail?id='+tjvenlist[i].id+'">'+tjvenlist[i].title+'</a>'+
                        '</p>'+
                        '</li>'
                    );
                }
            }
        }else {
            $("#Recommend").append('<div class="public-no-message-detail"></div>');
        }
    }
    /*function showTimeList(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 3;
        //page pageSize  cultid  type  styletype
        var params = {
            page: params_page,
            pageSize: params_rows,
            id: itemId
        }
        dataInit.ajax({
            api: [[${apiPath.supplyTimeList}]],
            fn: function (data) {
                timeList(data);
                dataInit.pageInit('artPagging', params_page, params_rows, data.total, showTimeList);
            },
            params: params
        });
    }
    function timeList(data) {
        if(data.code == 0 && data.rows.length>0){
            var _timeList = data.rows;
            if(_timeList.length<10 && data.total <10){
                $("#artPagging").hide();
            }
            $("#timeList").empty();
            var TimeListHtml = "";
            for (var i in _timeList) {
                var activeTime = moment(_timeList[i].timestart).format('YYYY-MM-DD HH:mm:ss');
                var endTime = moment(_timeList[i].timeend).format('YYYY-MM-DD HH:mm:ss');
                var j = parseInt(i) + 1;
                TimeListHtml += '<tr>' +
                    '<td class="not-conform">' + j + '</td>' +
                    '<td class="not-conform">' + activeTime + '</td>' +
                    '<td class="not-conform">' + endTime + '</td>' +
                    '</tr>';
            }
            $("#timeList").html(TimeListHtml);
        }else {
            rongDialog.init({
                ico : 2, //1 勾  2 叉
                type : 1,
                desc : data.msg
            });
        }
    }*/
    //硬件配置
    function showYjpzList(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 3;
        //page pageSize  cultid  type  styletype
        var params = {
            page: params_page,
            pageSize: params_rows,
            entid: itemId,
            type:5
        }
        dataInit.ajax({
            api: [[${apiPath.yjpzList}]],
            fn: function (data) {
                yjpzList(data);
                dataInit.pageInit('yjpzPagging', params_page, params_rows, data.total, showYjpzList);
            },
            params: params
        });
    }
    function yjpzList(data) {
        if(data.code == 0 && data.rows.length>0){
            var _timeList = data.rows;
            if(_timeList.length<10 && data.total <10){
                $("#yjpzPagging").hide();
            }
            $("#yjpzList").empty();
            var TimeListHtml = "<tr><th>序列</th><th>硬件名称</th><th>硬件描述</th></tr>";
            for (var i in _timeList) {
                var activeTime =_timeList[i].name;
                var endTime = _timeList[i].detail;
                var j = parseInt(i) + 1;
                TimeListHtml += '<tr>' +
                        '<td class="not-conform">' + j + '</td>' +
                        '<td class="not-conform">' + activeTime + '</td>' +
                        '<td class="not-conform">' + endTime + '</td>' +
                        '</tr>';
            }
            $("#yjpzList").html(TimeListHtml);
        }else {
            $("#yjpz").hide();
//            rongDialog.init({
//                ico : 2, //1 勾  2 叉
//                type : 1,
//                desc : data.msg
//            });
        }
    }

    //培训人员
    function showpxryList(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 3;

        var params = {
            page: params_page,
            pageSize: params_rows,
            entid: itemId
        }
        dataInit.ajax({
            api: [[${apiPath.pxryList}]],
            fn: function (data) {
                pxryList(data);
                dataInit.pageInit('pxryPagging', params_page, params_rows, data.total, showpxryList);
            },
            params: params
        });
    }
    function pxryList(data) {
        if(data.code == 0 && data.rows.length>0){
            var _timeList = data.rows;
            if(_timeList.length<10 && data.total <10){
                $("#pxryPagging").hide();
            }
            $("#pxryList").empty();
            var TimeListHtml = "<tr><th>序列</th><th>姓名</th><th>性别</th><th>学历</th><th>专长</th></tr>";
            for (var i in _timeList) {
                var activeTime =_timeList[i].name;
                var endTime = _timeList[i].sex;
                if(endTime == 0){
                    endTime = "女";
                }else{
                    endTime = "男";
                }
                var _activeTime =_timeList[i].xueli;
                var _endTime = _timeList[i].special;
                var j = parseInt(i) + 1;
                TimeListHtml += '<tr>' +
                        '<td class="not-conform">' + j + '</td>' +
                        '<td class="not-conform">' + activeTime + '</td>' +
                        '<td class="not-conform">' + endTime + '</td>' +
                        '<td class="not-conform">' + _activeTime + '</td>' +
                        '<td class="not-conform">' + _endTime + '</td>' +
                        '</tr>';
            }
            $("#pxryList").html(TimeListHtml);
        }else {
            $("#pxry").hide();
        }
    }
    /*function supplyGetGxCity(data) {
        if( data.code == 0 && data.data){
            $("#range").html(data.data.city);
        }else {
            $("#rangeContent").hide();
        }
    }*/

    //获取资源数据
    function resDate(type){
        var enttype = type ? type : 1;
        dataInit.ajax({
            api:[[${apiPath.resourceList}]],
            params:{
                refid:itemId,
                reftype:5,
                enttype:enttype
            },
            fn:function(data){
                showResList(data,enttype);
            }
        })
    }
    //生成资源列表
    function showResList(data,type){
        var modelUL = $("#modelList_2");
        var type = type+"";
        modelUL.empty();
        if(data.code == 0){
            if (data.data.length > 0) {
                for (var i in data.data) {
                    var module = data.data[i];
                    var html = $('<li>\
                                    <div class="img">\
                                        <img >\
                                    </div>\
                                    <div class="info">\
                                        <div class="title">'+module.name+'</div>\
                                    </div>\
                                    <div class="mask"><img></div>\
                                    <a href="javascript:void(0)"></a>\
                                    </li>');
                    if(module.enturl){
                        var _enturl = module.enturl.indexOf('http') >= 0 ? module.enturl : data.imgPath + module.enturl;
                    }
                    var resBasePath = [[${basePath}]];
                    switch (type){
                        case "1" : //图片
                            html.find(".img img").attr("src", dataInit.getRemoteURL(data.imgPath , dataInit.getMidImage(module.enturl)));
                            html.find(".mask").empty();
                            html.find("a:last").attr("onClick", "rongDialog.init({\
                                            ico : 1,\
                                            type : 6,\
                                            imgUrl : '"+_enturl+"',\
                                            title : '"+ module.name +"'\
                                        });"
                            );
                            break;
                        case "2" :  //视频
                            html.find(".img img").attr("src", dataInit.getRemoteURL(data.imgPath , dataInit.getMidImage(module.deourl)));
                            html.find(".mask img").attr("src", [[${basePath}]] + '/assets/img/brand/play.png');
                            html.find("a:last").attr("onClick", "rongDialog.init({\
                                            type : 5,\
                                            vedioUrl : '"+_enturl+"',\
                                            vedioImg : '',\
                                            vedioTitle : '"+module.name+"',\
                                            basePath : '"+resBasePath+"'\
                                        })"
                            );
                            break;
                        case "3" :  //音频
                            //alert(resBasePath+"/assets/img/brand/brand-music.jpg");
                            html.find(".img img").attr("src", [[${basePath}]] + '/assets/img/brand/brand-music.jpg');
                            html.find(".mask img").attr("src", [[${basePath}]] + '/assets/img/brand/macphone.png');
                            html.find("a:last").attr("onClick", "rongDialog.init({\
                                            type : 5,\
                                            vedioUrl : '"+_enturl+"',\
                                            vedioType: 'mp3',\
                                            vedioImg : '"+resBasePath+"/assets/img/brand/brand-music.jpg',\
                                            vedioTitle : '"+module.name+"',\
                                            basePath : '"+resBasePath+"'\
                                        });setWidth();"
                            );
                            break;

                        case "4" : //文档
                            //html.find(".img img").attr("src", [[${basePath}]] + '/assets/img/brand/xiazai.jpg');
                            var iconImg = dataInit.getFileTypeIcon(module.enturl, '/assets/img/brand/xiazai.jpg');
                            html.find(".img img").attr("src", [[${basePath}]] + iconImg);

                            html.find(".mask").empty();
                            html.find("a:last").attr({
                                target:"_blank",
                                href: dataInit.getRemoteURL(data.imgPath , module.enturl)
                            });
                            break;

                        default:
                            html.find(".mask").empty();
                    }
                    modelUL.append(html);
                }
            } else {
                modelUL.append("<div class='public-no-message'></div>");
            }
        }else {
            $("#res-cont").hide();
        }
    }


    $(function(){
        var showDeliveryUrl = [[${apiPath.showDelivery}]];
        ShowApplyList.init(showDeliveryUrl, dataInit.getUrlParam('id'));
    });
</script>
<script th:src="${basePath}+'/assets/common/js/showapplylist.js'"></script>
<script th:src="${basePath}+'/assets/common/js/showapplytimes.js'"></script>
</body>
</html>