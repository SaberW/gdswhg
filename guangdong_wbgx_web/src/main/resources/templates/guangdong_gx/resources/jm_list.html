<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong_gx/public/resource :: copy"></head>
<body>
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong_gx/public/header :: copy"></div>
        <!--公共主头部结束-->
        <!--主体开始-->
        <div class="categoryChange">
            <div class="row clearfix">
                <div class="title">区域：</div>
                <div class="adrList" id="areList"><span class="item active"><a href="javascript:void(0)" onclick="setArea(this,null)">全部</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017072516954870)">广州市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083195263801)">深圳市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083156798432)">东莞市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083179520836)">惠州市</a></span></div>
            </div>
            <div class="row clearfix">
                <div class="title">类型：</div>
                <div class="adrList" id="typeList">
                    <span class="item active"><a href="javascript:void(0)" onclick="setArea(this,null)">全部</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017072516954870)">广州市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083195263801)">深圳市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083156798432)">东莞市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083179520836)">惠州市</a></span>
                </div>
            </div>
            <div class="row clearfix">
                <div class="title">配送范围：</div>
                <div class="adrList" id="psList">
                    <span class="item active"><a href="javascript:void(0)" onclick="setArea(this,null)">全部</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017072516954870)">广州市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083195263801)">深圳市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083156798432)">东莞市</a></span><span class="item"><a href="javascript:void(0)" onclick="setArea(this,2017083179520836)">惠州市</a></span>
                </div>
            </div>
            <input type="hidden" id="type">
            <input type="hidden" id="psprovince">
            <input type="hidden" id="pscity">
        </div>
        <div class="container content">
            <div class="page-list" style="margin-top:0px; padding-top:30px">
                <!--<div class="public-no-message"></div>-->
                <div class="content-list" id="modelList">
                    <ul class="clearfix">

                    </ul>
                </div>
                <!--分页开始 -->
                <div class="green-black" id="artPagging" style="margin-bottom: 40px"></div>
                <!--分页结束-->
            </div>
        </div>
        <!--主体结束-->
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong_gx/public/footer :: copy"></div>
<!--底部结束-->
<a class="to-top"></a>
<!--<script th:src="${basePath}+'/assets/js/activity/activitylist.js'" type="text/javascript"></script>-->
<script type="text/javascript" th:inline="javascript">
    $(document).ready(function () {
        dataInit.ajax({
            api: [[${apiPath.supplyGetTypes}]],
            params: {
                cultid: $.cookie('cultid'),
                type:21//分类type
            },
            fn: showType
        });
        showAre($.cookie("city"));
        showPsArea();
        dataPage();
    })

    function dataPage(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 12;
        //page pageSize  cultid  type  styletype
        var params = {
            page: params_page,
            pageSize: params_rows,
            cultid: $.cookie('cultid'),
            ekey: '', //场馆关键字
            area: $("#area").val(), //区域
            city: $("#city").val(), //市
            province: $("#province").val(), //省
            deptid: $("#deptid").val(), //部门id
            psprovince: $("#psprovince").val(), //省
            pscity: $("#pscity").val(), //省
            type: $("#type").val(), //场馆类型
            styletype: '', //场馆区域
            etag: '', //场馆标签
            content: '' //模糊查询
        }
        dataInit.ajax({
            api: [[${apiPath.resJmList}]],
            params: params,
            fn: function(data){
                //console.log(data);
                showModelList(data);
                dataInit.pageInit('artPagging', params_page, params_rows, data.total, dataPage);
            }
        })
    }

    function showType(data) {
        $("#typeList").html("");
        var region = data.rows;
        var typeList = $("#typeList");
        typeList.append("<span class='item active'><a href='javascript:void(0)' onclick='setType(this," + null + ")'>全部</a></span>")
        for (var i in region) {
            typeList.append("<span class='item'><a href='javascript:void(0)' onclick=setType(this,'"+ region[i].id + "')>" + region[i].name + "</a></span>");
        }
    }


    function showModelList(data) {
        $("#modelList").html("");
        var modelList = $("#modelList");
        if(data.code == 0){
            if (data.rows.length > 0) {
                modelList.append("<ul class='clearfix'></ul>");
                for (var i in data.rows) {
                    var model = data.rows[i];
                    var imgPath = data.imgPath + dataInit.getBigImage(model.image);
                    var startTime = moment(model.crtdate).format('YYYY-MM-DD');
                    modelList.children("ul").append(
                        '<li> ' +
                        '<a href="detail?id='+model.id+'" target="_blank"> ' +
                        '<div class="img"> ' +
                        '<img src="'+imgPath+'" width="283" height="190"> ' +
                        '</div> ' +
                        '</a> ' +
                        '<div class="detail"> ' +
                        '<h2>'+model.title+'</h2> ' +
                        '<p><span class="tt">所属文化馆：</span><span class="desc">'+model.cultidname+'</span></p> ' +
                        '<p><span class="tt">发布时间：</span><span class="desc">'+startTime+'</span></p> ' +
                        '</div> ' +
                        '</li>'
                    );
                }
            } else {
                modelList.append("<div class='public-no-message'></div>");
            }
        }else {
            rongDialog.init({ico : 2, type : 1, desc : data.msg});
        }
    }
    function setActive(dom){
        $(dom).parent('span').addClass("active").siblings().removeClass("active");
    }

    function setType(dom, id) {
        $("#type").val(id);
        dataPage();
        setActive(dom);
    }

    function setState(dom, id) {
        $("#sdate").val(id);
        dataPage();
        setActive(dom);
    }
    function searchList() {
        if($("#searchValue").val()){
            var searchValue = removeHTMLTag($("#searchValue").val());
            $("#searchId").val(searchValue);
            dataPage();
        }else {
            $("#searchId").val("");
            dataPage();
        }
    }
    //给消息过滤HTML标签
    function removeHTMLTag(str) {
        str = str.replace(/<\/?[^>]*>/g,''); //去除HTML tag
        str = str.replace(/[ | ]*\n/g,'\n'); //去除行尾空白
        //str = str.replace(/\n[\s| | ]*\r/g,'\n'); //去除多余空行
        str=str.replace(/&nbsp;/ig,'');//去掉&nbsp;
        return str;
    }

</script>
</body>
</html>