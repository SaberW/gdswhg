<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong/public/resource :: copy"></head>
<body>
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong/public/header :: copy"></div>
        <!--公共主头部结束-->
        <!--主体开始-->
        <div class="categoryChange">
            <div class="row clearfix">
                <div class="title">区域：</div>
                <div class="adrList" id="areList">

                </div>
            </div>
            <div class="row clearfix">
                <div class="title">类型：</div>
                <div class="adrList" id="regList">

                </div>
            </div>
            <div class="row clearfix">
                <div class="title">艺术类型：</div>
                <div class="adrList" id="artList">

                </div>
            </div>
            <input type="hidden" id="type">
            <input type="hidden" id="arttype">
            <input type="hidden" id="sdate">
            <input type="hidden" id="searchId">
        </div>
        <div class="container content">
            <div class="filter">
                <div class="filter-list">
                    <div class="clearfix">
                        <span class="active"><a href="javascript:void(0)" onclick="setState(this,'1')">智能排序</a></span>
                        <span><a href="javascript:void(0)" onclick="setState(this,'2')">即将开始</a></span>
                        <span><a href="javascript:void(0)" onclick="setState(this,'3')">最新发布</a></span>
                    </div>
                </div>
                <div class="search">
                    <input type="text" id="searchValue" onkeydown="if(event.keyCode==13) searchList();" placeholder="输入关键词">
                    <a href="javascript:searchList()"><i class="iconfont icon-search"></i></a>
                </div>
            </div>
            <div class="page-list">
                <!--<div class="public-no-message"></div>-->
                <div class="content-list activityList" id="activityList">
                    <ul class="clearfix">
                        <!--<li>
                            <a href="detail">
                                <div class="img">
                                    <img th:src="${basePath}+'/assets/img/img_demo/activi-img1.jpg'" width="283" height="190">
                                </div>
                            </a>
                            <div class="detail">
                                <h2>台州戏剧节丨《莫欺少年穷》经典演段 不容错过</h2>
                                <p><span class="tt">地点：</span><span class="desc">台州市广场中路58号台州文化艺术中心一楼1202室</span></p>
                                <p><span class="tt">时间：</span><span class="desc">2016-10-15</span></p>
                                <p><span class="tt">余票：</span><span class="desc">50</span></p>
                            </div>
                            <div class="button clearfix">
                                <a href="#">马上预定</a>
                                <div class="likes on">
                                    <i class="iconfont icon-praise"></i>
                                    <span>23</span>
                                </div>
                                <div class="collection on">
                                    <i class="iconfont icon-collection"></i>
                                    <span>5</span>
                                </div>
                            </div>
                        </li>-->
                    </ul>
                </div>
                <!--分页开始 -->
                <div class="green-black" id="artPagging" style="margin-bottom: 40px"></div>
                <!--分页结束-->
            </div>
        </div>
        <!--主体结束-->
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong/public/footer :: copy"></div>
<!--底部结束-->
<a class="to-top"></a>
<!--<script th:src="${basePath}+'/assets/js/activity/activitylist.js'" type="text/javascript"></script>-->
<script type="text/javascript" th:inline="javascript">
    $(document).ready(function () {
        dataInit.ajax({
            api: [[${apiPath.actCate}]],
            params: {
                type:4,//活动分类type
                cultid: $.cookie('cultid')
            },
            fn: showVenueClass
        });
        dataInit.ajax({
            api: [[${apiPath.actCate}]],
            params: {
                type:1,//艺术分类
                cultid: $.cookie('cultid')
            },
            fn: showYXClass
        });
        showAre($.cookie("city"));
        dataPage();
    })

    function dataPage(page,rows) {
        var params_page = page || 1;
        var params_rows = rows || 12;
        var params = {
            index: params_page,
            size: params_rows,
            cultid: $.cookie('cultid'),
            keywords: $("#searchId").val(),
            area: $("#area").val(), //区域
            deptid: $("#deptid").val(), //部门id
            city: $("#city").val(), //市
            province: $("#province").val(), //省
            type: $("#type").val(),
            district: $("#area").val(),
            sort: $("#sdate").val(),
            arttype: $("#arttype").val()
        }
        rongDialog.init({ico: 3, type: 1, desc: '', overTime: 8000});
        dataInit.ajax({
            api: [[${apiPath.actList}]],
            params: params,
            fn: function(data){
                rongDialog.closeMaskPanel();
                showActivityList(data);
                dataInit.pageInit('artPagging', params_page, params_rows, data.total, dataPage);
            }
        })
    }

    function showVenueClass(data) {
        $("#regList").html("");
        var region = data.rows;
        var regList = $("#regList");
        regList.append("<span class='item active'><a href='javascript:void(0)' onclick='setType(this," + null + ")'>全部</a></span>")
        for (var i in region) {
            regList.append("<span class='item'><a href='javascript:void(0)' onclick=setType(this,'"+ region[i].id + "')>" + region[i].name + "</a></span>");
        }
    }

    function showYXClass(data) {
        var artList = $("#artList");
        artList.html("");
        var arts = data.rows;
        artList.append("<span class='item active'><a href='javascript:void(0)' onclick='setArtType(this," + null + ")'>全部</a></span>");
        for (var i in arts){
            artList.append("<span class='item'><a href='javascript:void(0)' onclick=setArtType(this,'"+ arts[i].id + "')>" + arts[i].name + "</a></span>");
        }
    }

    function showVenueArea(data) {
        $("#adrList").html("");
        var cate = data.rows;
        var adrList = $("#adrList");
        adrList.append("<span class='item active'><a href='javascript:void(0)' onclick='setArea(this," + null + ")'>全部</a></span>")
        for (var i in cate) {
            adrList.append("<span class='item'><a href='javascript:void(0)' onclick='setArea(this," + cate[i].id + ")'>" + cate[i].name + "</a></span>");
        }
    }

    function showActivityList(data) {
        $("#activityList").html("");
        var act = data.rows;
        var actList = $("#activityList");
        if(data.code == 0){
            if (act.length > 0) {
                actList.append("<ul class='clearfix'></ul>");
                for (var i in act) {
                    var imgPath = [[${imgPath}]] + dataInit.getBigImage(act[i].imgurl);
                    var startTime = moment(act[i].starttime).format('YYYY-MM-DD');
                    var endTime = moment(act[i].endtime).format('YYYY-MM-DD');
                    var time=startTime + ' ~ ' + endTime;
                    if(startTime==endTime){
                        time=startTime;
                    }
                    var a_label = '';
                    var liststate =  act[i].liststate;
                    var ticketnum=act[i].ticketnum;
                    var ticketAllnum=act[i].ticketAllnum;
                    var currNum= ticketAllnum-ticketnum;
                    if(liststate == 1){
                        a_label= '<a href="detail?id='+act[i].id+'&type=1">立即预订</a>';
                    }else if(liststate == 2){
                        a_label= '<a href="detail?id='+act[i].id+'&type=1">已订完</a>';
                    }else if(liststate == 3){
                        if(act[i].acturl != null && act[i].acturl != ""){
                            a_label= '<a href="detail?id='+act[i].id+'&type=1" class="just-go">查看链接</a>';
                        }else{
                            a_label= '';
                        }

                    }else if(liststate == 4){
                        a_label= '<a href="detail?id='+act[i].id+'&type=1" class="complete">活动已结束</a>';
                    }else{
                        a_label= '<a href="detail?id='+act[i].id+'&type=1">即将开始</a>';
                    }
                    var actHtml="";
                    actHtml+= '<li> ' +
                        '<a href="detail?id='+act[i].id+'"> ' +
                        '<div class="img"> ' +
                        '<img src="'+imgPath+'" width="283" height="190"> ' +
                        '</div> ' +
                        '</a> ' +
                        '<div class="detail"> ' +
                        '<h2>'+act[i].name+'</h2> ' +
                        '<p><span class="tt">地点：</span><span class="desc">'+act[i].address+'</span></p> ' +
                        '<p><span class="tt">时间：</span><span class="desc">'+time+'</span></p> ';
                        if(liststate != 3){
                            //actHtml+= '<p><span class="tt">余票：</span><span class="desc">'+ticketnum+'</span></p> ';
                            actHtml+= '<p><span class="tt">票数：</span><span class="desc">'+currNum+' / '+ticketAllnum+' 张</span></p> ';
                        }
                        if(act[i].acturl != null && act[i].acturl != ""){

                        }

                     actHtml+= '</div> ' +
                        '<div class="button clearfix"> ' +a_label+
                        '<div class="likes on"> ' +
                        '<i class="iconfont icon-praise"></i> ' +
                        '<span>'+act[i].dianzan+'</span> ' +
                        '</div> ' +
                        '<div class="collection on"> ' +
                        '<i class="iconfont icon-collection"></i> ' +
                        '<span>'+act[i].shoucang+'</span> ' +
                        '</div> ' +
                        '</div> ' +
                        '</li>'
                        /*'<li>'+
                        '<a href="detail?id='+act[i].id+'&type=1">'+
                        '<div class="img">'+
                        '<img src="'+imgPath+'" width="280" height="210">'+
                        '<div class="mask"></div>'+
                        '</div>'+
                        '</a>'+
                        '<div class="detail">'+
                        '<h2>'+act[i].name+'</h2>'+
                        '<p><span class="tt">地点：</span><span class="desc">'+act[i].address+'</span></p>'+
                        '<p><span class="tt">时间：</span><span class="desc">'+startTime+'</span></p>'+
                        '<p><span class="tt">费用：</span><span class="desc">免费</span></p>'+
                        '</div>'+
                        '<div class="button clearfix">'+a_label+
                        '<div class="collection on">'+
                        '<i></i>'+
                        '<span>'+act[i].shoucang+'</span>'+
                        '</div>'+
                        '<div class="likes on">'+
                        '<i></i>'+
                        '<span>'+act[i].dianzan+'</span>'+
                        '</div>'+
                        '</div>'+
                        '</li>'*/
                    actList.children("ul").append(actHtml);}
            } else {
                actList.append("<div class='public-no-message'></div>");
            }
        }else {
            rongDialog.init({ico : 2, type : 1, desc : data.msg});
        }
    }
    function setActive(dom){
        $(dom).parent('span').addClass("active").siblings().removeClass("active");
    }

    function setType(dom, id) {
        $("#type").val(id);
        dataPage();
        setActive(dom);
    }

    function setArtType(dom, id){
        $("#arttype").val(id);
        dataPage();
        setActive(dom);
    }

    function setState(dom, id) {
        $("#sdate").val(id);
        dataPage();
        setActive(dom);
    }
    function searchList() {
        if($("#searchValue").val()){
            var searchValue = removeHTMLTag($("#searchValue").val());
            $("#searchId").val(searchValue);
            dataPage();
        }else {
            $("#searchId").val("");
            dataPage();
        }
    }
    //给消息过滤HTML标签
    function removeHTMLTag(str) {
        str = str.replace(/<\/?[^>]*>/g,''); //去除HTML tag
        str = str.replace(/[ | ]*\n/g,'\n'); //去除行尾空白
        //str = str.replace(/\n[\s| | ]*\r/g,'\n'); //去除多余空行
        str=str.replace(/&nbsp;/ig,'');//去掉&nbsp;
        return str;
    }

</script>
</body>
</html>