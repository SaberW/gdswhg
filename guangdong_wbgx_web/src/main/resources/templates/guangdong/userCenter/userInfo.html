<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="guangdong/public/resource :: copy"></head>
<body>
<link th:href="${basePath}+'/assets/style/userCenter/userCenter.css'" rel="stylesheet">
<script type="text/javascript" th:src="${basePath}+'/assets/js/plugs/rong.validate.js'"></script>
<script type="text/javascript" th:src="${basePath}+'/assets/js/plugs/rong.message.js'"></script>
<div class="wrapper clearfix">
    <div class="content">
        <!--公共主头部开始-->
        <div id="header" th:include="guangdong/public/header :: copy"></div>
        <!--公共主头部结束-->
        <div class="main main-boder clearfix">
            <div class="leftPanel" th:include="guangdong/userCenter/left :: copy"></div>
            <div class="rightPanel">
                <ul class="commBtn clearfix">
                    <li class="active">基本信息</li>
                </ul>
                <form action="" method="post" id="realForm">
                    <div class="formContainer">
                        <dl class="clearfix">
                            <dt class="float-left">昵称</dt>
                            <dd class="float-left">
                                <input class="in-txt" placeholder="添加个性昵称" minlength="2" maxlength="10" id="nickname"
                                       name="nickname" required>
                                <em></em></dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="float-left">性别</dt>
                            <dd class="float-left">
                                <div class="radio radio-success">
                                    <input type="radio" value="1" name="sex" checked id="r1">
                                    <label for="r1">男</label>
                                    <input type="radio" value="0" name="sex" id="r2">
                                    <label for="r2">女</label>
                                </div>
                            </dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="float-left">职业</dt>
                            <dd class="float-left">
                                <div class="box float-left">
                                    <div class="rong-select">
                                        <ul>
                                            <li opt-val="其它">其它</li>
                                            <li opt-val="政府机关">政府机关</li>
                                            <li opt-val="互联网">互联网</li>
                                            <li opt-val="电子商务">电子商务</li>
                                            <li opt-val="信息传媒">信息传媒</li>
                                            <li opt-val="通信">通信</li>
                                            <li opt-val="金融">金融</li>
                                            <li opt-val="学生">学生</li>
                                            <li opt-val="其它">其它</li>
                                        </ul>
                                    </div>
                                    <script type="text/javascript">
                                        var ul_h = $('.rong-select').height();
                                        var m = $('.rong-select')
                                        m.toggle(function () {
                                            m.children("ul").css({
                                                height: "auto"
                                            });
                                        }, function () {
                                            m.children("ul").css({
                                                height: ul_h
                                            });
                                        });
                                        $('.rong-select ul li').on("click", function () {
                                            var opt_val = $(this).attr("opt-val");
                                            m.find("ul li:first").attr("opt-val", opt_val);
                                            m.find("ul li:first").html(opt_val);
                                            $("#job").val(opt_val);
                                        })
                                    </script>
                                    <input type="hidden" name="job" id="job">
                                    <!--            <select>
                                                  <option value="">请选择</option>
                                                  <option value="政府机关">政府机关</option>
                                                  <option value="互联网">互联网</option>
                                                  <option value="电子商务">电子商务</option>
                                                  <option value="信息传媒">信息传媒</option>
                                                  <option value="通信">通信</option>
                                                  <option value="金融">金融</option>
                                                  <option value="学生">学生</option>
                                                  <option value="其它">其它</option>
                                                </select>-->
                                </div>
                                <em></em></dd>
                        </dl>
                        <!--<dl class="clearfix">
                            <dt class="float-left">出生日期</dt>
                            <dd class="float-left">
                                <div class="box float-left">
                                    <input class="in-txt dateChange" placeholder="请选择" id="dateCont" name="birthday" required>
                                </div>
                                <em></em></dd>
                            <script type="text/javascript">
                                $('.dateChange').on('click',
                                    function () {
                                        laydate({
                                            elem: '#dateCont'
                                        });
                                    })
                            </script>
                        </dl>-->
                        <dl class="clearfix">
                            <dt class="float-left">手机号码</dt>
                            <dd class="float-left">
                                <div class="box float-left">
                                    <input class="in-txt" type="text" name="phone" id="phone"
                                           placeholder="联系电话" maxlength="11" disabled="disabled">
                                </div>
                                <em></em></dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="float-left">&nbsp;</dt>
                            <dd class="float-left">
                                <input class="submit none" type="submit" value="Submit">
                                <div class="goNext float-left">修 改</div>
                            </dd>
                        </dl>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--底部开始-->
<div class="footer-container" id="footer" th:include="guangdong/public/footer :: copy"></div>
<!--底部结束-->
<!-- core public JavaScript -->
<script th:src="${basePath}+'/assets/js/plugins/laydate.dev.min.js'"></script>
<script type="text/javascript" th:inline="javascript">
    $(document).ready(function () {
        $("#realForm").validate({
            errorElement: "em",
            submitHandler: function () {
                var params = {};
                var temp_list = $("#realForm [name]").serializeArray();
                for (var i in temp_list) {
                    params[temp_list[i].name] = temp_list[i].value;
                }
                params["id"] = [[${session.wbgx_sessUserKey.userId}]];
                dataInit.ajax({
                    api: [[${apiPath.hasNickName}]],
                    params: {
                        id: [[${session.wbgx_sessUserKey.userId}]],
                        nickName: params.nickname
                    },
                    fn: function (data) {
                        if (data.code == 0) {
                            //console.log(params);
                            dataInit.ajax({
                                api: [[${apiPath.userEdit}]],
                                params: params,
                                fn: function (data) {
                                    //console.log(data);
                                    if (data.code == 0) {
                                        rongDialog.init({
                                            ico: 1,
                                            type: 1,
                                            desc: "修改成功",
                                            nextFn: function () {
                                                window.location.href = 'info';
                                            }
                                        });
                                    } else {
                                        rongDialog.init({
                                            ico: 2,
                                            type: 1,
                                            desc: data.errMsg || "完善资料失败"
                                        });
                                    }
                                }
                            })
                        } else {
                            rongDialog.init({
                                ico: 2,
                                type: 1,
                                desc: data.errMsg || "昵称重复"
                            });
                        }
                    }
                })
            }
        });
        dataInit.ajax({
            api: [[${apiPath.userInfo}]],
            params: {
                userId: [[${session.wbgx_sessUserKey.userId}]]
            },
            fn: function (data) {
                //console.log(data);
                $("#dateCont").val(data.data.birthday);
                $("#nickname").val(data.data.nickName);
                if (data.data.sex == "1") {
                    $("#r1").attr("checked", "checked");
                    $("#r2").removeAttr("checked");
                } else {
                    $("#r2").attr("checked", "checked");
                    $("#r1").removeAttr("checked");
                }
                if (data.data.authState ==1 || data.data.authState == 3){
                    $("input[name='sex']:not(:checked)").attr("disabled","disabled");
                }
                $(".rong-select ul li:first").attr("opt-val", data.data.job).html(data.data.job);
                $("#job").val(data.data.job);
                $("#phone").val(data.data.mobile);
            }
        });
    });
    $(".goNext").on("click", function () {
        $(".submit").click();
    })
</script>
</body>
</html>
